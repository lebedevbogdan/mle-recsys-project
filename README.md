# Подготовка виртуальной машины

## Склонируйте репозиторий

Склонируйте репозиторий проекта:

```
git clone git@github.com:practicum-mle/mle-recsys-project.git
```

## Активируйте виртуальное окружение

Используйте то же самое виртуальное окружение, что и созданное для работы с уроками. Если его не существует, то его следует создать.

Создать новое виртуальное окружение можно командой:

```
python3 -m venv env_recsys_start
```

После его инициализации следующей командой

```
. env_recsys_start/bin/activate
```

установите в него необходимые Python-пакеты следующей командой

```
pip install -r requirements.txt
```

### Скачайте файлы с данными

Для начала работы понадобится три файла с данными:
- [tracks.parquet](https://storage.yandexcloud.net/mle-data/ym/tracks.parquet)
- [catalog_names.parquet](https://storage.yandexcloud.net/mle-data/ym/catalog_names.parquet)
- [interactions.parquet](https://storage.yandexcloud.net/mle-data/ym/interactions.parquet)
 
Скачайте их в директорию локального репозитория. Для удобства вы можете воспользоваться командой wget:

```
wget https://storage.yandexcloud.net/mle-data/ym/tracks.parquet

wget https://storage.yandexcloud.net/mle-data/ym/catalog_names.parquet

wget https://storage.yandexcloud.net/mle-data/ym/interactions.parquet
```

## Запустите Jupyter Lab

Запустите Jupyter Lab в командной строке

```
jupyter lab --ip=0.0.0.0 --no-browser
```

# Предобработка данных

Код для предварительной обработки данных находится в файле `part_1_preprocess_eda.ipynb`.

# Расчёт рекомендаций

Код для расчёта рекомендаций находится в файле `part_2_recs.ipynb`.

# Инструкции для тестирования сервиса

Код сервиса рекомендаций находится в файле `recommendations_service.py`.

В задании нужно было создать один сервис, поэтому загрузка всех данных происходит в рамках одного сервиса. Специально были сгенерированы сэмплы датафреймов для пары пользователей (пользователь с событиями и "холодный" пользователь), чтобы их можно было загрузить на Github, а также использовать для тестирования работы сервиса.

Для онлайн-рекомендаций берется последний трек, с которым взаимодействовал пользователь, и находятся похожие треки. Исключается тот же самый трек. Смешивание происходит чередованием онлайн и офлайн рекомендаций. Если каких-то из этих рекомендаций больше, то они добавляются в конец.

Для запуска сервиса необходимо выполнить команду из директории services:
```
uvicorn recommendations_service:app
```

Код для тестирования сервиса находится в файле `test_service.py`.

Для запуска кода тестирования нужно выполнить команду из корневой папки:
```
python3 -m unittest services/test_service.py
```
Код отправляет два запроса для двух видов пользователей: с взаимодействиями и для пользователя с холодным стартом.
